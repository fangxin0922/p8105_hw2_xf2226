p8105\_hw2\_xf2226
================
Xin Fang
10/3/2021

# problem 1

## Read in and clean Mr. Trash Wheel sheet

``` r
mr_trash_wheel_df <- readxl::read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx", sheet = 1, range = cellranger::cell_cols("A:N"), skip = 1) %>% # specified the sheet in the Excel file, using sheet = 1; omited non-data entries, using range = cellranger::cell_cols("A:N") and skip = 1
  janitor::clean_names() %>% #use reasonable variable names
  filter(!is.na(dumpster)) #omit rows that do not include dumpster-specific data

mr_trash_wheel_df$sports_balls <- round(pull(mr_trash_wheel_df, sports_balls), 0) #round the number of sports balls to the nearest integer
```

## Read and clean precipitation data for 2018 and 2019

``` r
sheets <- readxl::excel_sheets("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx") #read in sheets

precipitation_2018_2019 <- do.call(rbind, lapply(sheets[4:5], function(X) 
        transform(readxl::read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx", sheet = X, skip = 1), sheetname = X))) #rbind the two seperate sheets and add a column containing the sheetnames

precipitation_2018_2019 <- precipitation_2018_2019 %>% 
  na.omit(Total) %>% #omit rows without precipitation data
  mutate(Year = substr(sheetname, 1, 4), Month = month.name[Month]) %>%  #add a variable for year and convert month to a character variable
  select(Year, Month, Total) %>% 
  as_tibble()
```

There are 344 observations in the Mr. Trash Wheel dataset and 18
observations in the precipitation dataset for year 2018 and 2019.

Some of the key variables in the Mr. Trash Wheel dataset are:  
`year` and `month` represents the year and month of trash collection  
`dumpster` column includes specific dumpster number  
`sports_balls` column includes the number of sports balls collected in
Mr. Trash Wheel on the given specific date and dumpster. The mean number
of sports balls is 11.8110465. And the median number of sports balls in
the dumpster in 2019 specifically is 8.5  
`weight_tons` represents the weight of trash in tons collected by
Mr. Trash Wheel on a given dumpster and date  

Some of the key variables in the precipitation dataset for year 2018 and
2019 are:  
`Year` represents the year of precipitation measuremens  
`Month` is the month of precipitation measurement  
`Total` column includes the total precipitation for the year-month  

The total precipitation measured in 2018 is 70.33

# Problem 2

## read and clean pols\_month

``` r
rm(list = ls()) #clean environment to start a new problem

pols_month <- read_csv("./data/fivethirtyeight_datasets/pols-month.csv") %>% #load pols_month dataset
  janitor::clean_names() 
```

    ## Rows: 822 Columns: 9

    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon

    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
pols_month <- pols_month %>%
  separate(mon, sep = "-", into = c("year", "month","day")) %>% #Use separate() to break up the variable mon into integer variables year, month, and day
  mutate(
    year = as.integer(year), 
    month = as.integer(month), 
    day = as.integer(day),
    month = month.name[month]) %>% 
  pivot_longer(c("prez_gop","prez_dem"), #a president variable taking values gop and dem
    names_to = "president",
    values_to = "president_boolean",
    names_prefix = "prez_"
  ) %>% 
  filter(president_boolean != 0) %>% 
  select(-c(president_boolean, day)) #remove the day variable
```

## read and clean the data in snp.csv

``` r
snp <- read_csv("./data/fivethirtyeight_datasets/snp.csv") %>% #load snp dataset
  janitor::clean_names() 
```

    ## Rows: 787 Columns: 2

    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close

    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
snp <- snp %>%
  mutate(
    year = lubridate::year(lubridate::mdy(date)), 
    month = lubridate::month(lubridate::mdy(date)), 
    month = month.name[month]) %>% 
  select(year, month, close) %>% #year and month are the leading columns
  arrange(year, month) #arrange according to year and month
```

## read and tidy unemplotment data

``` r
unemployment <- read_csv("./data/fivethirtyeight_datasets/unemployment.csv") %>% 
  janitor::clean_names() 

unemployment <- unemployment %>% 
  pivot_longer(
    jan:dec, 
    names_to = 'month', 
    values_to = "unemployment_rate"
  ) %>% 
  mutate(
    year = as.integer(year),
    month = apply(as.matrix(month), 1, function(abb){
      s <- str_to_title(abb)
      for (i in 1:12) {
        if (month.abb[i] == s ) {
          return(month.name[i])
        }
      }
    }
    ))

unemployment
```

    ## # A tibble: 816 × 3
    ##     year month     unemployment_rate
    ##    <int> <chr>                 <dbl>
    ##  1  1948 January                 3.4
    ##  2  1948 February                3.8
    ##  3  1948 March                   4  
    ##  4  1948 April                   3.9
    ##  5  1948 May                     3.5
    ##  6  1948 June                    3.6
    ##  7  1948 July                    3.6
    ##  8  1948 August                  3.9
    ##  9  1948 September               3.8
    ## 10  1948 October                 3.7
    ## # … with 806 more rows

## Join the datasets by merging snp into pols, and merging unemployment into the result.

``` r
fivethirtyeight_merged <- pols_month %>% 
  left_join(snp, by = c("year", "month")) %>% 
  left_join(unemployment, by = c("year", "month"))

skimr::skim_without_charts(fivethirtyeight_merged)
```

|                                                  |                         |
|:-------------------------------------------------|:------------------------|
| Name                                             | fivethirtyeight\_merged |
| Number of rows                                   | 822                     |
| Number of columns                                | 11                      |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_   |                         |
| Column type frequency:                           |                         |
| character                                        | 2                       |
| numeric                                          | 9                       |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ |                         |
| Group variables                                  | None                    |

Data summary

**Variable type: character**

| skim\_variable | n\_missing | complete\_rate | min | max | empty | n\_unique | whitespace |
|:---------------|-----------:|---------------:|----:|----:|------:|----------:|-----------:|
| month          |          0 |              1 |   3 |   9 |     0 |        12 |          0 |
| president      |          0 |              1 |   3 |   3 |     0 |         2 |          0 |

**Variable type: numeric**

| skim\_variable     | n\_missing | complete\_rate |    mean |     sd |      p0 |     p25 |     p50 |     p75 |    p100 |
|:-------------------|-----------:|---------------:|--------:|-------:|--------:|--------:|--------:|--------:|--------:|
| year               |          0 |           1.00 | 1980.75 |  19.79 | 1947.00 | 1964.00 | 1981.00 | 1998.00 | 2015.00 |
| gov\_gop           |          0 |           1.00 |   22.48 |   5.68 |   12.00 |   18.00 |   22.00 |   28.00 |   34.00 |
| sen\_gop           |          0 |           1.00 |   46.10 |   6.38 |   32.00 |   42.00 |   46.00 |   51.00 |   56.00 |
| rep\_gop           |          0 |           1.00 |  194.92 |  29.24 |  141.00 |  176.00 |  195.00 |  222.00 |  253.00 |
| gov\_dem           |          0 |           1.00 |   27.20 |   5.94 |   17.00 |   22.00 |   28.00 |   32.00 |   41.00 |
| sen\_dem           |          0 |           1.00 |   54.41 |   7.37 |   44.00 |   48.00 |   53.00 |   58.00 |   71.00 |
| rep\_dem           |          0 |           1.00 |  244.97 |  31.37 |  188.00 |  211.00 |  250.00 |  268.00 |  301.00 |
| close              |        264 |           0.68 |  643.34 | 561.55 |   63.54 |  114.69 |  413.37 | 1146.78 | 2107.39 |
| unemployment\_rate |         12 |           0.99 |    5.83 |   1.65 |    2.50 |    4.70 |    5.60 |    6.90 |   10.80 |
